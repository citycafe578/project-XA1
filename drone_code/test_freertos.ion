#include <Arduino.h>

TaskHandle_t Task1;
TaskHandle_t Task2;


QueueHandle_t queue;


void Task1code(void * parameter) {
  int count = 0;
  for (;;) {

    if (xQueueSend(queue, &count, portMAX_DELAY) == pdPASS) {
      Serial.print("Task 1 sent: ");
      Serial.println(count);
      count++;
    }
    vTaskDelay(1000 / portTICK_PERIOD_MS);  // 延迟1秒
  }
}


void Task2code(void * parameter) {
  int receivedValue;
  for (;;) {

    if (xQueueReceive(queue, &receivedValue, portMAX_DELAY) == pdPASS) {
      Serial.print("Task 2 received: ");
      Serial.println(receivedValue);
    }
  }
}

void setup() {

  Serial.begin(115200);


  queue = xQueueCreate(10, sizeof(int));
  if (queue != NULL) {

    xTaskCreate(
      Task1code,
      "Task1",
      10000,
      NULL,
      1,
      &Task1
    );


    xTaskCreate(
      Task2code,
      "Task2",
      10000,
      NULL,
      1,
      &Task2
    );
  } else {
    Serial.println("Failed to create queue");
  }
}

void loop() {

}
